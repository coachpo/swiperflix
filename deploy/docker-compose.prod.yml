services:
  # Caddy reverse proxy
  caddy:
    image: caddy:2-alpine
    container_name: swiperflix-caddy
    networks:
      - swiperflix_net
    ports:
      - "8066:80"
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile:ro
      - swiperflix_caddy_data:/data
      - swiperflix_caddy_config:/config
      - swiperflix_caddy_logs:/var/log/caddy
    depends_on:
      - player
      - gateway
    restart: unless-stopped

  # Gateway API service - using GitHub Container Registry
  gateway:
    image: ghcr.io/coachpo/swiperflix-gateway:latest
    container_name: swiperflix-gateway
    networks:
      - swiperflix_net
    expose:
      - "8000"
    env_file:
      - gateway.env
    volumes:
      - swiperflix_db:/data
    restart: unless-stopped

  # Player frontend service - using GitHub Container Registry
  player:
    image: ghcr.io/coachpo/swiperflix-player:latest
    container_name: swiperflix-player
    networks:
      - swiperflix_net
    expose:
      - "3000"
    depends_on:
      - gateway
    restart: unless-stopped

volumes:
  swiperflix_caddy_data:
    driver: local
  swiperflix_caddy_config:
    driver: local
  swiperflix_caddy_logs:
    driver: local
  swiperflix_db:
    driver: local

networks:
  swiperflix_net:
    name: swiperflix_net
    driver: bridge
